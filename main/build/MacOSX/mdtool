#!/bin/sh

# Author: Marc Christensen (mchristensen@novell.com)
OSX_VERSION=$(uname -r | cut -f1 -d.)
MONO=`which mono`

reWrite() {
    ret=""
    WD=`pwd`
    for arg in "$@"
    do
	if [ -f "./$arg" ]
	then
	    ret="$ret '$WD/$arg'"
	else
	    ret="$ret '$arg'"
	fi
   done

    echo "$ret"
}
 
MD_BIN_PATH=/tmp/install/lib/monodevelop/bin

### SYNCH BLOCK: any changes to this block should be kept in sync with the one in Makefile.include and monodevelop.in
MD_PKG_CONFIG_PATH=/tmp/build_deps/lib/pkgconfig/:/usr/lib/pkgconfig/:/usr/local/lib/pkgconfig/:/usr/share/pkgconfig/:/usr/local/share/pkgconfig/
if test -d /usr/lib64; then MD_PKG_CONFIG_PATH=$MD_PKG_CONFIG_PATH:/usr/lib64/pkgconfig/:/usr/local/lib64/pkgconfig/; fi
### END BLOCK

if [ -n $PKG_CONFIG_PATH ]; then
	export PKG_CONFIG_PATH=$PKG_CONFIG_PATH:$MD_PKG_CONFIG_PATH
else
	export PKG_CONFIG_PATH=$MD_PKG_CONFIG_PATH
fi

eval set -- `reWrite "$@"`

ARGS=

case x$1 in
	x--profile)
		shift
		ARGS=--profile
		#exec -a "mdtool" $MONO --profile $MD_BIN_PATH/mdrun.exe "$@"
		#exit 0
		;;
	x--debug)
		shift
		export MONODEVELOP_DISPATCH_DEBUG=yes
		ARGS=--debug
		#exec -a "mdtool" $MONO --debug $MD_BIN_PATH/mdrun.exe "$@"
		#exit 0
		;;
	x--trace)
		shift
		ARGS=--trace
		#exec -a "mdtool" $MONO --trace $MD_BIN_PATH/mdrun.exe "$@"
		#exit 0;
		;;
esac

if [ OSX_VERSION -lt 9 ]; then  # OSX 10.4 or earlier
	$MONO $ASSEMBLY "$@"
else  # OSX 10.5
	exec -a $MONO $MD_BIN_PATH/mdrun.exe "$@"
fi





